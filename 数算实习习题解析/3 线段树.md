# 线段树 

区间更新，区间查询。

Log(N).

## 1 线段树的定义

- 应该称之为“区间树”。是一棵二叉树。树上的每个节点对应于一个区间[a,b] (也称线段）a,b通常为整数。
- 同一层的节点代表的区间，相互不会重叠。
- 同一层节点代表的区间，加起来是连续区间。
- 左儿子$[a, (a+b)/2]$，右儿子$[(a+b)/2 + 1, b]$
- 叶节点的区间长度为1

## 2 线段树的特性

- 最多二分$log_2(b-a+1)$（上取整）就会分到叶子结点。
- 因此深度为$log_2(b-a+1) + 1$（上取整）。也就是$log_2(n) + 1$（上取整），n是区间的长度。
- 叶子结点的数目和根节点的区间长度相同。
- 节点为0度或者2度。
- 若叶节点有N个，那么总节点共2N-1个。
- 区间分解复杂度是log(n)，n是根区间长度。

## 3 线段树解题

关键是想清楚每个节点要存哪些信息，以及信息如何高效更新，维护，查询，不要一更近就更新到叶子结点。

```c++
struct CNode{
    int L,R; //区间的左右端点
    //其他有关的数据
    CNode * pLeft,*pRight;
}
```

用一维数组存放线段树，共有2n-1个元素。

根节点下标为0，对下标为i的元素，左子节点下标为$2i+1$，右子节点下标为$2i+2$。

数组需要

数组开4N可以保证不越界。

